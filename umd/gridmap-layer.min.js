!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=20)}([function(t,e,n){"use strict";function o(t,e,n,r){if(!(this instanceof o))return new o(t,e,n,r);var i,s,a;t.x?(n=t.w,r=t.h,e=t.y,0!==t.w&&!t.w&&t.x2?(n=t.x2-t.x,r=t.y2-t.y):(n=t.w,r=t.h),t=t.x,i=t+n,s=e+r,a=!(r+n)):(i=t+n,s=e+r,a=!(r+n)),this.x1=this.x=function(){return t},this.y1=this.y=function(){return e},this.x2=function(){return i},this.y2=function(){return s},this.w=function(){return n},this.h=function(){return r},this.p=function(){return a},this.overlap=function(n){return a||n.p()?t<=n.x2()&&i>=n.x()&&e<=n.y2()&&s>=n.y():t<n.x2()&&i>n.x()&&e<n.y2()&&s>n.y()},this.expand=function(o){var a,u,h=o.x(),c=o.y(),l=o.x2(),f=o.y2();return a=t>h?h:t,u=e>c?c:e,n=i>l?i-a:l-a,r=s>f?s-u:f-u,t=a,e=u,this}}o.overlapRectangle=function(t,e){return 0===t.h&&0===t.w||0===e.h&&0===e.w?t.x<=e.x+e.w&&t.x+t.w>=e.x&&t.y<=e.y+e.h&&t.y+t.h>=e.y:t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y},o.containsRectangle=function(t,e){return t.x+t.w<=e.x+e.w&&t.x>=e.x&&t.y+t.h<=e.y+e.h&&t.y>=e.y},o.expandRectangle=function(t,e){var n,o,r=t.x+t.w,i=e.x+e.w,s=t.y+t.h,a=e.y+e.h;return n=t.x>e.x?e.x:t.x,o=t.y>e.y?e.y:t.y,t.w=r>i?r-n:i-n,t.h=s>a?s-o:a-o,t.x=n,t.y=o,t},o.makeMBR=function(t,e){if(!t.length)return{x:0,y:0,w:0,h:0};(e=e||{}).x=t[0].x,e.y=t[0].y,e.w=t[0].w,e.h=t[0].h;for(var n=1,r=t.length;n<r;n++)o.expandRectangle(e,t[n]);return e},o.squarifiedRatio=function(t,e,n){var o=(t+e)/2,r=t*e;return r*n/(r/(o*o))},t.exports=o},function(t,e,n){"use strict";t.exports=function(t,e,n){var r=t*e,i=o*t,s=i-(i-t),a=t-s,u=o*e,h=u-(u-e),c=e-h,l=a*c-(r-s*h-a*h-s*c);if(n)return n[0]=l,n[1]=r,n;return[l,r]};var o=+(Math.pow(2,27)+1)},function(t,e,n){"use strict";e.__esModule=!0;e.default=function(t){return{balloonContentBody:"\n                    <ul>\n                        "+t.map(function(t){return"<li>"+t.feature.properties.Attributes.Name+"</li>"}).join("")+"\n                    </ul>\n                ",balloonContentHeader:t.length+" точек",balloonContentFooter:"Нижняя часть балуна.",hintContent:"Тут "+t.length+" точек"}}},function(t,e,n){"use strict";e.__esModule=!0;e.default=function(){this._options.get("map").geoObjects.remove(this.polygonActive)}},function(t,e,n){"use strict";e.__esModule=!0;e.default=function(t){var e=t.originalEvent.activeObject,n=this._options.get("map");n.geoObjects.remove(this.polygonActive),this.polygonActive=new ymaps.Polygon([e._properties.objectGeometry],{hintContent:"Polygon"},{fillColor:"#00FF0088",strokeWidth:3}),n.geoObjects.add(this.polygonActive)}},function(t,e,n){"use strict";e.__esModule=!0;e.default=function(){this._options.get("map").geoObjects.remove(this.polygonHover)}},function(t,e,n){"use strict";e.__esModule=!0;e.default=function(t){var e=t.originalEvent.activeObject,n=this._options.get("map");this.polygonHover=new ymaps.Polygon([e._properties.objectGeometry],{hintContent:"Polygon"},{fillColor:"#00FF0088",strokeWidth:3}),n.geoObjects.add(this.polygonHover)}},function(t,e,n){"use strict";ymaps.modules.define("HotspotObjectSourceBrowser",["util.defineClass","util.extend","hotspot.ObjectSource"],function(t,e,n,o){var r=function t(e,o){t.superclass.constructor.call(this,"",n({},o)),this.options.set("getHotspotsForTile",o.getHotspotsForTile)};e(r,o,{requestObjects:function(t,e,n,o){var r={data:{type:"FeatureCollection",features:this.options.get("getHotspotsForTile")(e,n)}};this.parseResponse(t,r,o,e,n)}}),t(r)})},function(t,e,n){"use strict";t.exports=function(t,e){var n=0|t.length,o=0|e.length;if(1===n&&1===o)return function(t,e){var n=t+e,o=n-t,r=t-(n-o)+(e-o);if(r)return[r,n];return[n]}(t[0],-e[0]);var r,i,s=new Array(n+o),a=0,u=0,h=0,c=Math.abs,l=t[u],f=c(l),p=-e[h],g=c(p);f<g?(i=l,(u+=1)<n&&(l=t[u],f=c(l))):(i=p,(h+=1)<o&&(p=-e[h],g=c(p)));u<n&&f<g||h>=o?(r=l,(u+=1)<n&&(l=t[u],f=c(l))):(r=p,(h+=1)<o&&(p=-e[h],g=c(p)));var y,d,v=r+i,x=v-r,b=i-x,m=b,_=v;for(;u<n&&h<o;)f<g?(r=l,(u+=1)<n&&(l=t[u],f=c(l))):(r=p,(h+=1)<o&&(p=-e[h],g=c(p))),(b=(i=m)-(x=(v=r+i)-r))&&(s[a++]=b),m=_-((y=_+v)-(d=y-_))+(v-d),_=y;for(;u<n;)(b=(i=m)-(x=(v=(r=l)+i)-r))&&(s[a++]=b),m=_-((y=_+v)-(d=y-_))+(v-d),_=y,(u+=1)<n&&(l=t[u]);for(;h<o;)(b=(i=m)-(x=(v=(r=p)+i)-r))&&(s[a++]=b),m=_-((y=_+v)-(d=y-_))+(v-d),_=y,(h+=1)<o&&(p=-e[h]);m&&(s[a++]=m);_&&(s[a++]=_);a||(s[a++]=0);return s.length=a,s}},function(t,e,n){"use strict";t.exports=function(t,e,n){var o=t+e,r=o-t,i=e-r,s=t-(o-r);if(n)return n[0]=s+i,n[1]=o,n;return[s+i,o]}},function(t,e,n){"use strict";var o=n(1),r=n(9);t.exports=function(t,e){var n=t.length;if(1===n){var i=o(t[0],e);return i[0]?i:[i[1]]}var s=new Array(2*n),a=[.1,.1],u=[.1,.1],h=0;o(t[0],e,a),a[0]&&(s[h++]=a[0]);for(var c=1;c<n;++c){o(t[c],e,u);var l=a[1];r(l,u[0],a),a[0]&&(s[h++]=a[0]);var f=u[1],p=a[1],g=f+p,y=g-f,d=p-y;a[1]=g,d&&(s[h++]=d)}a[1]&&(s[h++]=a[1]);0===h&&(s[h++]=0);return s.length=h,s}},function(t,e,n){"use strict";t.exports=function(t,e){var n=0|t.length,o=0|e.length;if(1===n&&1===o)return function(t,e){var n=t+e,o=n-t,r=t-(n-o)+(e-o);if(r)return[r,n];return[n]}(t[0],e[0]);var r,i,s=new Array(n+o),a=0,u=0,h=0,c=Math.abs,l=t[u],f=c(l),p=e[h],g=c(p);f<g?(i=l,(u+=1)<n&&(l=t[u],f=c(l))):(i=p,(h+=1)<o&&(p=e[h],g=c(p)));u<n&&f<g||h>=o?(r=l,(u+=1)<n&&(l=t[u],f=c(l))):(r=p,(h+=1)<o&&(p=e[h],g=c(p)));var y,d,v=r+i,x=v-r,b=i-x,m=b,_=v;for(;u<n&&h<o;)f<g?(r=l,(u+=1)<n&&(l=t[u],f=c(l))):(r=p,(h+=1)<o&&(p=e[h],g=c(p))),(b=(i=m)-(x=(v=r+i)-r))&&(s[a++]=b),m=_-((y=_+v)-(d=y-_))+(v-d),_=y;for(;u<n;)(b=(i=m)-(x=(v=(r=l)+i)-r))&&(s[a++]=b),m=_-((y=_+v)-(d=y-_))+(v-d),_=y,(u+=1)<n&&(l=t[u]);for(;h<o;)(b=(i=m)-(x=(v=(r=p)+i)-r))&&(s[a++]=b),m=_-((y=_+v)-(d=y-_))+(v-d),_=y,(h+=1)<o&&(p=e[h]);m&&(s[a++]=m);_&&(s[a++]=_);a||(s[a++]=0);return s.length=a,s}},function(t,e,n){"use strict";var o=n(1),r=n(11),i=n(10),s=n(8),a=5;function u(t,e){for(var n=new Array(t.length-1),o=1;o<t.length;++o)for(var r=n[o-1]=new Array(t.length-1),i=0,s=0;i<t.length;++i)i!==e&&(r[s++]=t[o][i]);return n}function h(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",h(t.slice(0,e)),",",h(t.slice(e)),")"].join("")}function c(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var e=[],n=0;n<t.length;++n)e.push(["scale(",h(c(u(t,n))),",",(o=n,1&o?"-":""),t[0][n],")"].join(""));return e;var o}function l(t){for(var e=[],n=[],a=function(t){for(var e=new Array(t),n=0;n<t;++n){e[n]=new Array(t);for(var o=0;o<t;++o)e[n][o]=["m",o,"[",t-n-1,"]"].join("")}return e}(t),l=[],f=0;f<t;++f)0==(1&f)?e.push.apply(e,c(u(a,f))):n.push.apply(n,c(u(a,f))),l.push("m"+f);var p=h(e),g=h(n),y="orientation"+t+"Exact",d=["function ",y,"(",l.join(),"){var p=",p,",n=",g,",d=sub(p,n);return d[d.length-1];};return ",y].join("");return new Function("sum","prod","scale","sub",d)(r,o,i,s)}var f=l(3),p=l(4),g=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,n){var o,r=(t[1]-n[1])*(e[0]-n[0]),i=(t[0]-n[0])*(e[1]-n[1]),s=r-i;if(r>0){if(i<=0)return s;o=r+i}else{if(!(r<0))return s;if(i>=0)return s;o=-(r+i)}var a=3.3306690738754716e-16*o;return s>=a||s<=-a?s:f(t,e,n)},function(t,e,n,o){var r=t[0]-o[0],i=e[0]-o[0],s=n[0]-o[0],a=t[1]-o[1],u=e[1]-o[1],h=n[1]-o[1],c=t[2]-o[2],l=e[2]-o[2],f=n[2]-o[2],g=i*h,y=s*u,d=s*a,v=r*h,x=r*u,b=i*a,m=c*(g-y)+l*(d-v)+f*(x-b),_=7.771561172376103e-16*((Math.abs(g)+Math.abs(y))*Math.abs(c)+(Math.abs(d)+Math.abs(v))*Math.abs(l)+(Math.abs(x)+Math.abs(b))*Math.abs(f));return m>_||-m>_?m:p(t,e,n,o)}];!function(){for(;g.length<=a;)g.push(l(g.length));for(var e=[],n=["slow"],o=0;o<=a;++o)e.push("a"+o),n.push("o"+o);var r=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(o=2;o<=a;++o)r.push("case ",o,":return o",o,"(",e.slice(0,o).join(),");");r.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),n.push(r.join(""));var i=Function.apply(void 0,n);for(t.exports=i.apply(void 0,[function(t){var e=g[t.length];return e||(e=g[t.length]=l(t.length)),e.apply(void 0,t)}].concat(g)),o=0;o<=a;++o)t.exports[o]=g[o]}()},function(t,e,n){t.exports=function(t,e){for(var n=e[0],r=e[1],i=t.length,s=1,a=i,u=0,h=i-1;u<a;h=u++){var c=t[u],l=t[h],f=c[1],p=l[1];if(p<f){if(p<r&&r<f){var g=o(c,l,e);if(0===g)return 0;s^=0<g|0}else if(r===f){var y=t[(u+1)%i],d=y[1];if(f<d){var g=o(c,l,e);if(0===g)return 0;s^=0<g|0}}}else if(f<p){if(f<r&&r<p){var g=o(c,l,e);if(0===g)return 0;s^=g<0|0}else if(r===f){var y=t[(u+1)%i],d=y[1];if(d<f){var g=o(c,l,e);if(0===g)return 0;s^=g<0|0}}}else if(r===f){var v=Math.min(c[0],l[0]),x=Math.max(c[0],l[0]);if(0===u){for(;h>0;){var b=(h+i-1)%i,m=t[b];if(m[1]!==r)break;var _=m[0];v=Math.min(v,_),x=Math.max(x,_),h=b}if(0===h)return v<=n&&n<=x?0:1;a=h+1}for(var w=t[(h+i-1)%i][1];u+1<a;){var m=t[u+1];if(m[1]!==r)break;var _=m[0];v=Math.min(v,_),x=Math.max(x,_),u+=1}if(v<=n&&n<=x)return 0;var M=t[(u+1)%i][1];n<v&&w<r!=M<r&&(s^=1)}}return 2*s-1};var o=n(12)},function(t,e,n){"use strict";var o=n(0),r=function(t,e){if(e&&e.bbox)return{leaf:e,x:e.bbox[0],y:e.bbox[1],w:e.bbox[2]-e.bbox[0],h:e.bbox[3]-e.bbox[1]};for(var n=t.length,o=0,r=new Array(n);o<n;)r[o]=[t[o][0],t[o][1]],o++;var i=r[0];n=r.length,o=1;for(var s={min:[].concat(i),max:[].concat(i)};o<n;)r[o][0]<s.min[0]?s.min[0]=r[o][0]:r[o][0]>s.max[0]&&(s.max[0]=r[o][0]),r[o][1]<s.min[1]?s.min[1]=r[o][1]:r[o][1]>s.max[1]&&(s.max[1]=r[o][1]),o++;var a={x:s.min[0],y:s.min[1],w:s.max[0]-s.min[0],h:s.max[1]-s.min[1]};return e&&(a.leaf=e),a},i={point:function(t,e){return e.insertSubtree({x:t.geometry.coordinates[0],y:t.geometry.coordinates[1],w:0,h:0,leaf:t},e.root)},multiPointLineString:function(t,e){return e.insertSubtree(r(t.geometry.coordinates,t),e.root)},multiLineStringPolygon:function(t,e){return e.insertSubtree(r(Array.prototype.concat.apply([],t.geometry.coordinates),t),e.root)},multiPolygon:function(t,e){return e.insertSubtree(r(Array.prototype.concat.apply([],Array.prototype.concat.apply([],t.geometry.coordinates)),t),e.root)},makeRec:function(t){return o(t.x,t.y,t.w,t.h)},geometryCollection:function(t,e){if(t.bbox)return e.insertSubtree({leaf:t,x:t.bbox[0],y:t.bbox[1],w:t.bbox[2]-t.bbox[0],h:t.bbox[3]-t.bbox[1]},e.root);for(var n,o=t.geometry.geometries,s=0,a=o.length,u=[];s<a;){switch((n=o[s]).type){case"Point":u.push(i.makeRec({x:n.coordinates[0],y:n.coordinates[1],w:0,h:0}));break;case"MultiPoint":case"LineString":u.push(i.makeRec(r(n.coordinates)));break;case"MultiLineString":case"Polygon":u.push(i.makeRec(r(Array.prototype.concat.apply([],n.coordinates))));break;case"MultiPolygon":u.push(i.makeRec(r(Array.prototype.concat.apply([],Array.prototype.concat.apply([],n.coordinates)))));break;case"GeometryCollection":a=(o=o.concat(n.geometries)).length}s++}var h=u[0];for(s=1,a=u.length;s<a;)h.expand(u[s]),s++;return e.insertSubtree({leaf:t,x:h.x(),y:h.y(),h:h.h(),w:h.w()},e.root)}};e.geoJSON=function(t){var e,n;if(Array.isArray(t))e=t.slice();else if(t.features&&Array.isArray(t.features))e=t.features.slice();else{if(!(t instanceof Object))throw"this isn't what we're looking for";e=[t]}for(var o=e.length,r=0;r<o;){if("Feature"===(n=e[r]).type)switch(n.geometry.type){case"Point":i.point(n,this);break;case"MultiPoint":case"LineString":i.multiPointLineString(n,this);break;case"MultiLineString":case"Polygon":i.multiLineStringPolygon(n,this);break;case"MultiPolygon":i.multiPolygon(n,this);break;case"GeometryCollection":i.geometryCollection(n,this)}r++}},e.bbox=function(){var t,e,n,o;switch(arguments.length){case 1:t=arguments[0][0][0],e=arguments[0][0][1],n=arguments[0][1][0],o=arguments[0][1][1];break;case 2:t=arguments[0][0],e=arguments[0][1],n=arguments[1][0],o=arguments[1][1];break;case 4:t=arguments[0],e=arguments[1],n=arguments[2],o=arguments[3]}return this.search({x:t,y:e,w:n-t,h:o-e})}},function(t,e,n){"use strict";var o=n(0);function r(t){if(!(this instanceof r))return new r(t);var e=3,n=6;isNaN(t)||(e=Math.floor(t/2),n=t);var i={x:0,y:0,w:0,h:0,id:"root",nodes:[]};this.root=i;var s=function(t){for(var e,n=t.slice(),o=[];n.length;)(e=n.pop()).nodes?n=n.concat(e.nodes):e.leaf&&o.push(e);return o},a=function(t,n,r){var i,a,u,h=[],c=[],p=[];if(!t||!o.overlapRectangle(t,r))return p;var g={x:t.x,y:t.y,w:t.w,h:t.h,target:n};for(c.push(r.nodes.length),h.push(r);h.length>0;){if(i=h.pop(),a=c.pop()-1,"target"in g)for(;a>=0;){if(u=i.nodes[a],o.overlapRectangle(g,u)){if(g.target&&"leaf"in u&&u.leaf===g.target||!g.target&&("leaf"in u||o.containsRectangle(u,g))){p="nodes"in u?s(i.nodes.splice(a,1)):i.nodes.splice(a,1),o.makeMBR(i.nodes,i),delete g.target;break}"nodes"in u&&(0,c.push(a),h.push(i),i=u,a=u.nodes.length)}a--}else if("nodes"in g){i.nodes.splice(a+1,1),i.nodes.length>0&&o.makeMBR(i.nodes,i);for(var y=0;y<g.nodes.length;y++)f(g.nodes[y],i);g.nodes=[],0===h.length&&i.nodes.length<=1?(g.nodes=l(i,!0,g.nodes,i),i.nodes=[],h.push(i),c.push(1)):h.length>0&&i.nodes.length<e?(g.nodes=l(i,!0,g.nodes,i),i.nodes=[]):delete g.nodes}else o.makeMBR(i.nodes,i);1}return p},u=function(t){for(var e=c(t);t.length>0;)h(t,e[0],e[1]);return e},h=function(t,n,r){for(var i,s,a,u=o.squarifiedRatio(n.w,n.h,n.nodes.length+1),h=o.squarifiedRatio(r.w,r.h,r.nodes.length+1),c=t.length-1;c>=0;c--){var l=t[c],f={};f.x=Math.min(n.x,l.x),f.y=Math.min(n.y,l.y),f.w=Math.max(n.x+n.w,l.x+l.w)-f.x,f.h=Math.max(n.y+n.h,l.y+l.h)-f.y;var p=Math.abs(o.squarifiedRatio(f.w,f.h,n.nodes.length+2)-u),g={};g.x=Math.min(r.x,l.x),g.y=Math.min(r.y,l.y),g.w=Math.max(r.x+r.w,l.x+l.w)-g.x,g.h=Math.max(r.y+r.h,l.y+l.h)-g.y;var y=Math.abs(o.squarifiedRatio(g.w,g.h,r.nodes.length+2)-h);(!s||!i||Math.abs(y-p)<i)&&(s=c,i=Math.abs(y-p),a=y<p?r:n)}var d=t.splice(s,1)[0];n.nodes.length+t.length+1<=e?(n.nodes.push(d),o.expandRectangle(n,d)):r.nodes.length+t.length+1<=e?(r.nodes.push(d),o.expandRectangle(r,d)):(a.nodes.push(d),o.expandRectangle(a,d))},c=function(t){for(var e,n,o=t.length-1,r=0,i=t.length-1,s=0,a=t.length-2;a>=0;a--){var u=t[a];u.x>t[r].x?r=a:u.x+u.w<t[o].x+t[o].w&&(o=a),u.y>t[s].y?s=a:u.y+u.h<t[i].y+t[i].h&&(i=a)}return Math.abs(t[o].x+t[o].w-t[r].x)>Math.abs(t[i].y+t[i].h-t[s].y)?o>r?(e=t.splice(o,1)[0],n=t.splice(r,1)[0]):(n=t.splice(r,1)[0],e=t.splice(o,1)[0]):i>s?(e=t.splice(i,1)[0],n=t.splice(s,1)[0]):(n=t.splice(s,1)[0],e=t.splice(i,1)[0]),[{x:e.x,y:e.y,w:e.w,h:e.h,nodes:[e]},{x:n.x,y:n.y,w:n.w,h:n.h,nodes:[n]}]},l=function(t,e,n,r){var i=[];if(!o.overlapRectangle(t,r))return n;for(i.push(r.nodes);i.length>0;)for(var s=i.pop(),a=s.length-1;a>=0;a--){var u=s[a];o.overlapRectangle(t,u)&&("nodes"in u?i.push(u.nodes):"leaf"in u&&(e?n.push(u):n.push(u.leaf)))}return n},f=function(t,e){var r;if(0===e.nodes.length)return e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,void e.nodes.push(t);for(var i,s=function(t,e){var n,r=-1,i=[],s=!0;i.push(e);for(var a=e.nodes;s||-1!==r;){s?s=!1:(i.push(a[r]),a=a[r].nodes,r=-1);for(var u=a.length-1;u>=0;u--){var h=a[u];if("leaf"in h){r=-1;break}var c=o.squarifiedRatio(h.w,h.h,h.nodes.length+1),l=Math.max(h.x+h.w,t.x+t.w)-Math.min(h.x,t.x),f=Math.max(h.y+h.h,t.y+t.h)-Math.min(h.y,t.y),p=o.squarifiedRatio(l,f,h.nodes.length+2);(r<0||Math.abs(p-c)<n)&&(n=Math.abs(p-c),r=u)}}return i}(t,e),a=t;s.length>0;){if(r&&"nodes"in r&&0===r.nodes.length){i=r,r=s.pop();for(var h=0;h<r.nodes.length;h++)if(r.nodes[h]===i||0===r.nodes[h].nodes.length){r.nodes.splice(h,1);break}}else r=s.pop();if("leaf"in a||"nodes"in a||Array.isArray(a)){if(Array.isArray(a)){for(var c=0;c<a.length;c++)o.expandRectangle(r,a[c]);r.nodes=r.nodes.concat(a)}else o.expandRectangle(r,a),r.nodes.push(a);if(r.nodes.length<=n)a={x:r.x,y:r.y,w:r.w,h:r.h};else{var l=u(r.nodes);a=l,s.length<1&&(r.nodes.push(l[0]),s.push(r),a=l[1])}}else o.expandRectangle(r,a),a={x:r.x,y:r.y,w:r.w,h:r.h}}};this.insertSubtree=f,this.getTree=function(){return i},this.setTree=function(t,e){return e||(e=i),o=t,(n=e).nodes=o.nodes,n.x=o.x,n.y=o.y,n.w=o.w,n.h=o.h,n;var n,o},this.search=function(t,e,n){return l(t,e,n=n||[],i)};this.remove=function(t,e){return e&&"function"!=typeof e?function(t,e){return a(t,e,i)}(t,e):function(t){for(var e,n=1,o=[];n>0;)n=(e=a(t,!1,i)).length,o=o.concat(e);return o}(t)},this.insert=function(t,e){return f({x:t.x,y:t.y,w:t.w,h:t.h,leaf:e},i)}}r.prototype.toJSON=function(t){return JSON.stringify(this.root,!1,t)},r.fromJSON=function(t){var e=new r;return e.setTree(JSON.parse(t)),e},t.exports=r,"function"!=typeof Array.isArray&&(Array.isArray=function(t){return"object"==typeof t&&"[object Array]"==={}.toString.call(t)})},function(t,e,n){"use strict";var o=n(15),r=n(14);o.prototype.bbox=r.bbox,o.prototype.geoJSON=r.geoJSON,o.Rectangle=n(0),t.exports=o},function(t,e,n){"use strict";e.__esModule=!0;var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.side=e}return t.prototype.getCentersForTile=function(t,e,n){for(var o=this.side/n,r=this.side/n,i=[t[0]*e,t[1]*e],s=Math.ceil(i[0]/o)-1,a=Math.ceil(i[1]/r)-1,u=[],h=[s*o-i[0],a*r-i[1]],c=h[0],l=h[1];l<e+1*r;){for(;c<e+1*o;)u.push([c,l]),c+=o;l+=r,c=h[0]}return u},t.prototype.getPixelVerticesForTile=function(t,e){var n=t[0],o=t[1],r=this.side/e,i=n-r/2,s=o-r/2;return[[i,s],[i,s+r],[i+r,s+r],[i+r,s]]},t.prototype.getBBox=function(t,e,n){var o=t[0],r=t[1],i=this.side/n,s=r-i/2;return{x:(o-i/2+e[0])*n,y:(s+e[1])*n,w:i*n,h:i*n}},t}();e.default=o},function(t,e,n){"use strict";e.__esModule=!0,e.sin=function(t){return Math.sin(Math.PI*t/180)},e.cos=function(t){return Math.cos(Math.PI*t/180)}},function(t,e,n){"use strict";e.__esModule=!0;var o=n(18);var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.R=e}return t.prototype.getCentersForTile=function(t,e,n){for(var r=this.R/n,i=(0,o.sin)(60)*r,s=1.5*r,a=2*i,u=[t[0]*e,t[1]*e],h=Math.ceil(u[0]/s)-1,c=Math.ceil(u[1]/a)-1,l=[],f=[h*s-u[0],c*a-u[1]],p=h,g=f[0],y=f[1];y<e+1*a;){for(;g<e+1*s;){var d=p%2==0?0:i;l.push([g,y+d]),p++,g+=s}y+=a,g=f[0],p=h}return l},t.prototype.getPixelVerticesForTile=function(t,e){var n=t[0],r=t[1],i=this.R/e;return[[(0,o.cos)(0),(0,o.sin)(0)],[(0,o.cos)(60),(0,o.sin)(60)],[(0,o.cos)(120),(0,o.sin)(120)],[(0,o.cos)(180),(0,o.sin)(180)],[(0,o.cos)(240),(0,o.sin)(240)],[(0,o.cos)(300),(0,o.sin)(300)],[(0,o.cos)(0),(0,o.sin)(0)]].map(function(t){var e=t[0],o=t[1];return[n+e*i,r+o*i]})},t.prototype.getBBox=function(t,e,n){var r=t[0],i=t[1],s=this.R/n,a=(0,o.sin)(60)*s;return{x:(r+e[0]-s)*n,y:(i+e[1]-a)*n,w:2*s*n,h:2*a*n}},t}();e.default=r},function(t,e,n){"use strict";var o=f(n(19)),r=f(n(17)),i=f(n(16)),s=f(n(13));n(7);var a=f(n(6)),u=f(n(5)),h=f(n(4)),c=f(n(3)),l=f(n(2));function f(t){return t&&t.__esModule?t:{default:t}}ymaps.modules.define("GridmapLayer",["Layer","util.hd","util.defineClass","util.extend","HotspotObjectSourceBrowser","option.Manager"],function(t,e,n,f,p,g,y){var d=n.getPixelRatio();t(function(){function t(e,n){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var s=new y({map:void 0,debug:!1,gridType:void 0,gridHexagonRadius:20,gridSquareSidelength:20,filterEmptyShapes:!1,emptyShapesColor:"rgba(255,255,255, 0)",shapeColor:function(t){for(var e=[200,80,20,10,5],n=["rgba(74,20,140, 0.8)","rgba(106,27,154, 0.8)","rgba(123,31,162, 0.8)","rgba(157,101,171, 0.8)","rgba(165,135,173, 0.8)"],o=t.length,r=n[e.length-1],i=0;i<e.length;i++)if(o<=e[i]&&o>e[i+1]){r=n[i];break}return r},strokeColor:"#666",strokeWidth:1,getHotspotProps:function(t){return{balloonContentBody:"The number of points is "+t.length,balloonContentHeader:"Object's data",balloonContentFooter:"Powered by Gridmap",hintContent:""+t.length}},hotspotLayerOptions:{zIndex:201,cursor:"pointer"},onMouseEnter:a.default,onMouseLeave:u.default,onClick:h.default,onBalloonClose:c.default,balloonContent:l.default,interactivity:!0});if(this._options=new y(n,s),!this._options.get("map"))throw new Error('option "map" is required');switch(this._projection=this._options.get("map").options.get("projection"),this._data=e.features,this._canvas=document.createElement("canvas"),this._canvas.width=256*d,this._canvas.height=256*d,this._tileSize=256,this._context=this._canvas.getContext("2d"),this._buildTree(),this._options.get("gridType")){case"hexagon":this._shape=new o.default(this._options.get("gridHexagonRadius"));break;case"square":this._shape=new r.default(this._options.get("gridSquareSidelength"));break;default:throw new Error("Unknown grid type")}var f=function(t,e){return i._getDataURL(t,e)};this.layer=new ymaps.Layer(f,{tileTransparent:!0}),this.objSource=new g(f,{getHotspotsForTile:function(t,e){return i._getHotspotsForTile(t,e)}}),this.hotspotLayer=new ymaps.hotspot.Layer(this.objSource,this._options.get("hotspotLayerOptions")),this._options.get("map").layers.add(this.hotspotLayer),this._options.get("map").layers.add(this.layer),this.events=this.hotspotLayer.events;var p=this._options.get("onMouseEnter"),v=this._options.get("onMouseLeave"),x=this._options.get("onClick"),b=this._options.get("onBalloonClose");this._options.set("onMouseEnter",p.bind(this)),this._options.set("onMouseLeave",v.bind(this)),this._options.set("onClick",x.bind(this)),this._options.set("onBalloonClose",b.bind(this)),this._options.get("interactivity")&&this._initInteractivity(this.hotspotLayer)}return t.prototype._initInteractivity=function(t){this.polygonHover=null,this.polygonActive=null;var e=this._options.get("onMouseEnter"),n=this._options.get("onMouseLeave"),o=this._options.get("onClick"),r=this._options.get("onBalloonClose");t.events.add("mouseenter",e),t.events.add("mouseleave",n),t.events.add("click",o),t.events.add("balloonclose",r)},t.prototype._buildTree=function(){var t=this;this._tree=new i.default,this._treeZoom=this._options.get("map").getZoom(),this._data.forEach(function(e){var n=t._projection.toGlobalPixels(e.geometry.coordinates,t._treeZoom),o=n[0],r=n[1],i={feature:e,pixelCoords:[o,r]};t._tree.insert({x:o,y:r,w:0,h:0},i)})},t.prototype._getScale=function(){return Math.pow(2,this._treeZoom-this._options.get("map").getZoom())},t.prototype._getPointsForShape=function(t,e,n){var o=this._getScale(),r=e.map(function(t){var e=t[0],r=t[1];return[(e+n[0])*o,(r+n[1])*o]}),i=this._shape.getBBox(t,n,o);return this._tree.search(i).filter(function(t){var e=t.pixelCoords;return(0,s.default)(r,e)<=0})},t.prototype._getTileOffset=function(t,e){return[t[0]*e,t[1]*e]},t.prototype._getHotspotsForTile=function(t){var e=this,n=[],o=this._getScale(),r=this._shape.getCentersForTile(t,this._tileSize,o),i=this._getTileOffset(t,this._tileSize),s=this._options.get("getHotspotProps");return r.forEach(function(t){var r=t[0],a=t[1],u=e._shape.getPixelVerticesForTile([r,a],o),h=e._getPointsForShape([r,a],u,i);if(h.length>0){var c=u.map(function(t){var n=t[0],o=t[1];return e._projection.fromGlobalPixels([n+i[0],o+i[1]],e._options.get("map").getZoom())}),f="function"==typeof s?s(h):(0,l.default)(h),p={points:h,objectGeometry:c,HotspotMetaData:{id:JSON.stringify(h),RenderedGeometry:{type:"Polygon",coordinates:[u]}}},g=Object.assign({},f,p);n.push({type:"Feature",properties:g})}}),n},t.prototype._drawTile=function(t){var e=this,n=this._getScale(),o=this._shape.getCentersForTile(t,this._tileSize,n),r=this._getTileOffset(t,this._tileSize);this._context.clearRect(0,0,this._canvas.width,this._canvas.height),o.forEach(function(t){var o=t[0],i=t[1],s=e._shape.getPixelVerticesForTile([o,i],n),a=e._getPointsForShape([o,i],s,r),u=a.length;e._options.get("filterEmptyShapes")&&0===u||(e._context.beginPath(),s.forEach(function(t,n){var o=t[0],r=t[1];0===n?e._context.moveTo(o*d,r*d):e._context.lineTo(o*d,r*d)}),e._context.fillStyle=u>0?e._options.get("shapeColor")(a):e._options.get("emptyShapesColor"),e._context.fill(),e._context.strokeStyle=e._options.get("strokeColor"),e._context.strokeWidth=e._options.get("strokeWidth"),e._context.stroke(),e._options.get("debug")&&(e._context.fillStyle="black",e._context.fillText(a.length,o,i)),e._context.closePath())})},t.prototype._getDataURL=function(t,e){return this._drawTile(t,e),this._canvas.toDataURL()},t}())})}]);